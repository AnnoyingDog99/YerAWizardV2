@{
    Layout = "~/_SiteLayout.cshtml";
    Page.Title = "PostPage";
    PageData["current"] = "Forums";

    string mail = "";
    string errorMsg = "";

    int Forum_Forum_Id = 0;
    string ForumName = "";
    string ForumDesc = "";
    string IsPrivate = "";

    int Post_Id = 2;
    string PostTitle = "";
    string PostContent = "";

    int Comment_Id = 0;
    string Username_Commenter = "";
    string CommenterRank = "";
    string Comment = "";
    string Comment_Time = "";
    string Comment_Date = "";

    string Username_Replier = "";

    string Rank = "";

    int Upvote = 0;
    int Downvote = 0;
    string UporDown = "";

    if (Session["mail"] != null)
    {
        mail = Session["mail"].ToString();
    }
    else { Response.Redirect("~/login.cshtml"); }

    if (Request.QueryString["ForumId"] != null && Request.QueryString["PostId"] != null && Request.QueryString["CommentId"] != null)
    {
        Forum_Forum_Id = Request.QueryString["ForumId"].AsInt();
        Post_Id = Request.QueryString["PostId"].AsInt();
        Comment_Id = Request.QueryString["CommentId"].AsInt();
    }
    else { Response.Redirect("~/ForumPage.cshtml"); }

    string connectionString = @"Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=|DataDirectory|\Harry_Potter.mdf;Integrated Security=True";
    string provider = "System.Data.SqlClient";
    Database db = Database.OpenConnectionString(connectionString, provider);

    var UserData = db.QuerySingle("SELECT * FROM Profiel WHERE Email = @0", mail);
    if (UserData == null)
    {
        Session.Abandon();
        Response.Redirect("~/login.cshtml");
    }
    Username_Replier = UserData.Username;
    Rank = UserData.Rank;
    var SelectForum = db.QuerySingle("SELECT * FROM [Forum] WHERE Forum_Id = @0", Forum_Forum_Id);
    var SelectPost = db.QuerySingle("SELECT * FROM [Post] WHERE Post_Id = @0", Post_Id);
    var SelectComment = db.QuerySingle("SELECT * FROM [Comments] WHERE Comment_Id = @0", Comment_Id);

    if (SelectComment != null)
    {
        Comment_Id = SelectComment.Comment_Id;
        Username_Commenter = SelectComment.Username_Username;
        CommenterRank = db.QuerySingle("SELECT Rank FROM Profiel WHERE Username = @0", Username_Commenter).Rank;
        Comment = SelectComment.Comment;
        Comment_Time = SelectComment.Time;
        Comment_Date = SelectComment.Date;
    }

    var SelectReplies = db.Query("SELECT * FROM [Replies] WHERE Comment_Comment_Id = @0 ORDER BY Reply_Id DESC", Comment_Id);


    if (SelectPost != null && SelectComment != null && SelectForum != null)
    {
        IsPrivate = db.QuerySingle("SELECT IsPrivate FROM [Forum] WHERE Forum_Id = @0", Forum_Forum_Id).IsPrivate;
        ForumName = db.QuerySingle("SELECT Forum_name FROM [Forum] WHERE Forum_Id = @0", Forum_Forum_Id).Forum_name;
        if (IsPrivate == "Y" && Rank != "Owner" && Rank != "Teacher")
        {
            Response.Redirect("~/ForumPage.cshtml");
        }
    }
    else { Response.Redirect("~/Forumpage.cshtml"); }

    if (IsPost)
    {
        if (Request.Form["post-reply"] != null)
        {
            Validation.RequireField("reply", "Please enter something");
            Validation.Add("reply", Validator.StringLength(200, 1, "You've exceeded the maximum comment size of 200 characters"));
            if (Validation.IsValid())
            {
                string time = DateTime.Now.ToShortTimeString();
                string date = DateTime.Now.ToShortDateString();
                db.Execute("INSERT INTO Replies (Forum_Forum_Id, Post_Post_Id, Comment_Comment_Id, Username_Username, Reply, Time, Date) VALUES (@0, @1, @2, @3, @4, @5, @6)", Forum_Forum_Id, Post_Id, Comment_Id, Username_Replier, Request.Form["reply"], time, date);
                if (Username_Replier != Username_Commenter)
                {
                    db.Execute("INSERT INTO Notifications(Profiel_Username, Subject_Username, Notification, Url) VALUES (@0, @1, @2, @3)", Username_Commenter, Username_Replier, ("Replied to your comment " + ((char)34) + Comment + ((char)34)), Request.RawUrl);
                }
                Response.Redirect("~/Replies.cshtml?CommentId=" + Comment_Id + "&PostId=" + Post_Id + "&ForumId=" + Forum_Forum_Id);
            }
        }
    }
}

<!DOCTYPE html>
<html>
<head>
    <link href="~/Stylesheets/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Stylesheets/Forum.css" rel="stylesheet" type="text/css" />
    <link href="~/Stylesheets/Comments.css" rel="stylesheet" type="text/css" />
    <link href="~/Stylesheets/Layout.css" rel="stylesheet" type="text/css" />
    <meta charset="utf-8" />
    <title></title>
</head>
<body style="background-color: #202225;">
    <div class="container">
        <div class="row" style="padding:20px">
            <div class="col-lg-12">
                <div class="wrapper wrapper-content animated fadeInRight">
                    <div class="ibox-content forum-container" style="background-color: #343a40; ">
                        <a href="CommentsPage.cshtml?ForumId=@Forum_Forum_Id&PostId=@Post_Id">back</a>
                        <div class="forum-title">
                            <h3 style="color: white">@ForumName</h3>
                        </div>
                        <div class="forum-item active" style="color:white;">
                            <div class="row">
                                <div class="col-md-9">
                                    <div class="forum-icon">
                                        <i class="fa fa-user" style="color: #dddddd"></i>
                                    </div>
                                    @switch (CommenterRank)
                                    {
                                        case "Student":
                                            <label class="forum-item-title" style="color:#007aff">@Username_Commenter <p class="rank">(@CommenterRank)</p></label>
                                            break;
                                        case "Teacher":
                                            <label class="forum-item-title" style="color:#007aff">@Username_Commenter <p class="rank" style="color: #cc3c71">(@CommenterRank)</p></label>
                                            break;
                                        case "Owner":
                                            <label class="forum-item-title" style="color:#007aff">@Username_Commenter <p class="rank" style="color: #ff7220">(@CommenterRank)</p></label>
                                            break;
                                    }
                                    <div class="forum-sub-title" style="color:white">@Comment</div>
                                </div>
                            </div>
                            <div id="date-time" class="row">
                                <div class="col-3">
                                    <label>@Comment_Time</label>
                                </div>
                                &nbsp;
                                <div class="col-3">
                                    <label>@Comment_Date</label>
                                </div>
                            </div>
                            <div style="padding-bottom: 6px;"></div>
                        </div>
                        <div>
                            <form method="post">
                                <input name="reply" placeholder="Reply something..." class="comment-box" type="text" />
                                <input name="post-reply" value="Post" class="comment-submit" type="submit" />
                            </form>
                        </div>
                        <br /><br />
                        <!-- Foreach -->
                        @foreach (var reply in SelectReplies)
                        {
                            var ReplierRank = db.QuerySingle("SELECT Rank FROM Profiel WHERE Username = @0", reply.Username_Username).Rank;
                            <div class="forum-item active" style="color: white; margin-left: 50px;">
                                <div class="row">
                                    <div class="col-md-9">
                                        <div class="forum-icon">
                                            <i class="fa fa-user" style="color: #dddddd"></i>
                                        </div>
                                        @switch (ReplierRank)
                                        {
                                            case "Student":
                                                <label class="forum-item-title" style="color:#007aff">@reply.Username_Username <p class="rank">(@ReplierRank)</p></label>
                                                break;
                                            case "Teacher":
                                                <label class="forum-item-title" style="color:#007aff">@reply.Username_Username <p class="rank" style="color: #cc3c71">(@ReplierRank)</p></label>
                                                break;
                                            case "Owner":
                                                <label class="forum-item-title" style="color:#007aff">@reply.Username_Username <p class="rank" style="color: #ff7220">(@ReplierRank)</p></label>
                                                break;
                                        }
                                        <div class="forum-sub-title" style="color:white">@reply.Reply</div>
                                    </div>
                                </div>
                                <div id="date-time" class="row">
                                    <div class="col-3">
                                        <label>@reply.Time</label>
                                    </div>
                                    &nbsp;
                                    <div class="col-3">
                                        <label>@reply.Date</label>
                                    </div>
                                </div>
                                <div style="padding-bottom: 6px;"></div>
                            </div>
                            <br />
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>